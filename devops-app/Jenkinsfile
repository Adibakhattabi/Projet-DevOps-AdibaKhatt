pipeline {
    agent any

    tools {
        maven 'Maven-3' // Doit correspondre au nom dans Jenkins > Global Tool Configuration [cite: 32]
    }

    stages {
        stage('Checkout') {
            steps {
                // Récupère le code depuis GitHub [cite: 33]
                checkout scm
            }
        }

        stage('Build & Test') {
            steps {
                dir('devops-app') {
                    // Nettoie, compile et lance les tests unitaires [cite: 33]
                    bat 'mvn clean test'
                }
            }
        }

        stage('Archive') {
            steps {
                dir('devops-app') {
                    // Crée le fichier .jar et l'archive dans Jenkins 
                    bat 'mvn package -DskipTests'
                    archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
                }
            }
        }

        stage('Notify Slack') {
            steps {
                // Notification Slack (Étape 3.4 du projet) 
                // Note : Nécessite le plugin 'Slack Notification'
                echo 'Envoi de la notification Slack...'
                // slackSend channel: '#votre-canal', message: "Build réussi : ${env.JOB_NAME}"
            }
        }
    }

    post {
        success {
            echo '✅ Intégration continue réussie !' [cite: 46]
        }
        failure {
            echo '❌ Échec du pipeline' [cite: 56]
        }
    }
}